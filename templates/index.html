ch{% extends 'base.html' %}
{% block content %}
<div class="animate__fadeInUp">
    <h1 class="mb-4" style="font-family: 'Cormorant Garamond', serif; font-size: 2.5rem;">Document Generator</h1>

    <!-- Document Type Dropdown -->
    <div class="mb-4">
        <label for="type_select" class="form-label">Document Type</label>
        <select id="type_select" class="form-select" style="background: rgba(255, 255, 255, 0.08); border-color: var(--muted);">
            <option value="">Select a type</option>
            {% for type in types %}
                <option value="{{ type }}">{{ type|capitalize }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Template Dropdown -->
    <div class="mb-4">
        <label for="template_select" class="form-label">Template</label>
        <select id="template_select" class="form-select" style="background: rgba(255, 255, 255, 0.08); border-color: var(--muted);">
            <option value="">Select a template</option>
        </select>
    </div>

    <!-- Error Message -->
    <div id="error_message" class="alert alert-danger rounded-3 p-2 mb-4 d-none"></div>

    <!-- Batch Processing Card -->
    <div class="card mb-4" style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.1);">
        <div class="card-body text-center">
            <h5 class="card-title" style="color: rgba(255,255,255,0.95); font-family: 'Cormorant Garamond', serif;">
                ðŸš€ New: Batch Document Generation
            </h5>
            <p class="card-text text-muted">
                Generate multiple documents at once with a single form. Select multiple templates, fill one form, and download all documents as a ZIP file.
            </p>
            <a href="/batch" class="btn btn-lg" 
               style="padding: 0.75rem 2rem; background: linear-gradient(45deg, #22c55e, #16a34a); color: white; border: none; border-radius: 8px; font-weight: 600; text-decoration: none; transition: all 0.3s ease;"
               onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 8px 25px rgba(34, 197, 94, 0.3)'"
               onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">
                Try Batch Generation
            </a>
        </div>
    </div>

    <!-- Recent Documents Table -->
    <h2 class="mt-5 mb-4" style="font-family: 'Cormorant Garamond', serif; font-size: 2rem;">Recent Documents</h2>
    <div class="table-responsive">
    <table class="table table-dark table-hover rounded-3 overflow-hidden">
    <thead>
        <tr>
            <th>File Name</th>
            <th>Document Type</th>
            <th>Download Options</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        {% for doc in recent_docs %}
        <tr style="transition: all 0.3s ease; border-bottom: 1px solid rgba(255,255,255,0.05);"
            onmouseover="this.style.background='rgba(255,255,255,0.03)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'"
            onmouseout="this.style.background='transparent'; this.style.boxShadow='none'">
            <td style="padding: 12px 15px; color: rgba(255,255,255,0.9); font-size: 0.95rem; border-right: 1px solid rgba(255,255,255,0.05);">{{ doc.file_path }}</td>
            <td style="padding: 12px 15px; color: rgba(255,255,255,0.8); font-size: 0.9rem; border-right: 1px solid rgba(255,255,255,0.05);">{{ doc.template.type|capitalize }}</td>
            <td style="padding: 12px 15px;">
                <div class="d-flex gap-2">
                    <a href="{{ url_for('download_docx', doc_id=doc.id) }}"
                       style="display: inline-block; padding: 0.4rem 0.8rem; background: linear-gradient(45deg, #6dd5ed, #2a8bf2); color: white; border-radius: 4px; text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(109, 213, 237, 0.3); font-size: 0.8rem; min-width: 60px; text-align: center;"
                       onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(109, 213, 237, 0.3)'"
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
                       title="Download as DOCX">
                        <i class="fas fa-file-word"></i> DOCX
                    </a>
                    <a href="{{ url_for('download_pdf', doc_id=doc.id) }}"
                       style="display: inline-block; padding: 0.4rem 0.8rem; background: linear-gradient(45deg, #f43f5e, #dc2626); color: white; border-radius: 4px; text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(244, 63, 94, 0.3); font-size: 0.8rem; min-width: 60px; text-align: center;"
                       onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(244, 63, 94, 0.3)'"
                       onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
                       title="Download as PDF">
                        <i class="fas fa-file-pdf"></i> PDF
                    </a>
                </div>
            </td>
            <td style="padding: 12px 15px;">
                <a href="{{ url_for('delete', document_id=doc.id) }}"
                   onclick="return confirm('Are you sure you want to delete this document?')"
                   style="display: inline-block; padding: 0.4rem 1.2rem; background: linear-gradient(45deg, #ff6b6b, #ff4757); color: white; border-radius: 4px; text-decoration: none; transition: all 0.3s ease; border: 1px solid rgba(255, 107, 107, 0.3); font-size: 0.85rem;"
                   onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 107, 0.3)'"
                   onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>


    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('index', page=page-1) if page > 1 else '#' }}" style="color: var(--text); background: rgba(255, 255, 255, 0.08); border-color: var(--muted);">Previous</a>
            </li>
            <li class="page-item disabled">
                <span class="page-link" style="color: var(--text); background: rgba(255, 255, 255, 0.08); border-color: var(--muted);">Page {{ page }} of {{ total_pages }}</span>
            </li>
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('index', page=page+1) if page < total_pages else '#' }}" style="color: var(--text); background: rgba(255, 255, 255, 0.08); border-color: var(--muted);">Next</a>
            </li>
        </ul>
    </nav>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#type_select').change(function() {
        var type = $(this).val();
        $('#template_select').html('<option value="">Select a template</option>');
        $('#error_message').removeClass('d-block').addClass('d-none').text('');
        if (!type) return;

        $.get('/templates', {type: type}, function(data) {
            if (data.error) {
                $('#error_message').text(data.error).removeClass('d-none').addClass('d-block');
                return;
            }
            var options = '<option value="">Select a template</option>';
            data.forEach(function(template) {
                options += '<option value="' + template.id + '">' + template.name + '</option>';
            });
            $('#template_select').html(options);
        }).fail(function() {
            $('#error_message').text('Failed to load templates').removeClass('d-none').addClass('d-block');
        });
    });

    $('#template_select').change(function() {
        var id = $(this).val();
        if (id) window.location.href = '/create/' + id;
    });
});
</script>
{% endblock %}